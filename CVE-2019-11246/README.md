# 漏洞分析

## 一、漏洞基本信息

| Item           | Details                                          | Note              |
| -------------- | ------------------------------------------------ | ----------------- |
| Project        | Kubernetes                                       |                   |
| Publish Date   | 2019-06-18                                       |                   |
| Confirm        | https://github.com/kubernetes/kubernetes/pull/76788   |              |
| CVE-ID         | CVE-2019-11246                                   | mitre, cvedetails |
| Exploits       | unpublished                                      | see in image      |
| Affect Version | < 1.12.9, < 1.13.6, < 1.14.2                     |                   |
| Fix Version    | 1.12.9, 1.13.6, 1.14.2                           |                   |
| Fix Commit     | https://github.com/kubernetes/kubernetes/pull/76788/commits  |       |
| CVSS           | 6.4 CVSS:3.0/AV:N/AC:H/PR:H/UI:R/S:U/C:H/I:H/A:H |                   |
| Vuln’s Author  | Charles Holmes                                   |                   |


## 二、组件简介
kubectl是Kubernetes命令行工具，使得你可以对Kubernetes集群运行命令，如使用kubectl来部署应用、监测和管理集群资源以及查看日志等等

## 三、漏洞详情

### 1. 介绍
kubectl cp命令在从容器中拷贝数据到主机时，没有校验从容器中返回的tar数据，可通过符号链接的方式实现路径穿越，覆盖主机上的任意文件

### 2. 影响
当从恶意镜像中往主机拷贝数据时，攻击者可利用恶意镜像覆盖主机任意文件，进而完成容器逃逸，控制宿主机

## 四、防御
禁止从不可信的镜像中往主机拷贝文件

## 五、漏洞复现
### 1. 复现环境
```
docker pull noirfate/vul-k8s-cve-2019-11246:1.0
```
### 2. 复现过程
```
docker-compose up
ssh -p12222 root@127.0.0.1
cd exploit
./run
```

## 六、漏洞分析

[分析文章](https://zhengyinyong.com/post/security-analysis-of-kubectl-cp-command/)

## 七、漏洞修复分析

增加了对符号链接相对路径的校验

## 八、漏洞挖掘方法与过程

## 九、同类问题挖掘方法

### 设计实现层

### Fuzz

### codeql

## 十、时间线

