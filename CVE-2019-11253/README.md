# 漏洞分析

## 一、漏洞基本信息

| Item           | Details                                          | Note              |
| -------------- | ------------------------------------------------ | ----------------- |
| Project        | Kubernetes                                       |                   |
| Publish Date   | 2019-10-02                                       |                   |
| Confirm        | https://github.com/kubernetes/kubernetes/issues/83253 |              |
| CVE-ID         | CVE-2019-11253                                   | mitre, cvedetails |
| Exploits       | disclose                                         | see in image      |
| Affect Version | <= 1.12.x, 1.13.0-1.13.11, 1.14.0-1.14.7, 1.15.0-1.15.4, 1.16.0-1.16.1  |  |
| Fix Version    | 1.13.12, 1.14.8, 1.15.5, 1.16.2                  |                   |
| Fix Commit     | https://github.com/kubernetes/kubernetes/pull/83436/commits  |       |
| CVSS           | 7.5 CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |                   |
| Vuln’s Author  |                                                  |                   |


## 二、组件简介
Kubernetes API 服务器验证并配置 API 对象的数据， 这些对象包括 pods、services、replicationcontrollers 等。 API 服务器为 REST 操作提供服务，并为集群的共享状态提供前端， 所有其他组件都通过该前端进行交互

## 三、漏洞详情

### 1. 介绍
此漏洞发生于`yaml`解析器，类似于`CVE-2003-1564`[Billion laughs attack](https://en.wikipedia.org/wiki/Billion_laughs_attack)。攻击者可使用一个包含许多实体间相互引用的`yaml`导致解析器递归解析，从而占用大量CPU和内存，实现拒绝服务攻击

### 2. 影响
- 1.14以前的k8s版本，`kube-apiserver`允许匿名发送`POST`请求到`apis/authorization.k8s.io/v1/selfsubjectaccessreviews`，故攻击者可匿名发送恶意`yaml`文件给`kube-apiserver`，导致拒绝服务攻击
- 具备权限的用户可通过创建`ConfigMap`对`kube-apiserver`施行拒绝服务攻击，[参考](https://stackoverflow.com/questions/58129150/security-yaml-bomb-user-can-restart-kube-api-by-sending-configmap/58133282#58133282)

## 四、防御
- 禁止匿名访问`kube-apiserver` 

## 五、漏洞复现
### 1. 复现环境
```
docker pull noirfate/vul-k8s-cve-2019-11253:1.0
```
### 2. 复现过程
```
docker-compose up
ssh -p12222 root@127.0.0.1
cd exploit
./run
```

## 六、漏洞分析
- [分析文章](https://www.researchgate.net/publication/333505459_Laughter_in_the_Wild_A_Study_into_DoS_Vulnerabilities_in_YAML_Libraries)

## 七、漏洞修复分析

对`yaml`解析器进行资源使用限制

## 八、漏洞挖掘方法与过程

## 九、同类问题挖掘方法

### 设计实现层

### Fuzz

### codeql

## 十、时间线

