# 漏洞分析

## 一、漏洞基本信息

| Item           | Details                                          | Note              |
| -------------- | ------------------------------------------------ | ----------------- |
| Project        | Kubernetes                                       |                   |
| Publish Date   | 2020-06-26                                       |                   |
| Confirm        | https://github.com/kubernetes/kubernetes/issues/92914  |             |
| CVE-ID         | CVE-2020-8559                                    | mitre, cvedetails |
| Exploits       | disclose                                         | see in image      |
| Affect Version | < 1.16.0, 1.16.0-1.16.12, 1.17.0-1.17.8, 1.18.0-1.18.5 |             |
| Fix Version    | 1.16.13, 1.17.9, 1.18.6                          |                   |
| Fix Commit     | https://github.com/kubernetes/kubernetes/pull/92970/commits   |      |
| CVSS           | 6.4 CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:U/C:H/I:H/A:H |                   |
| Vuln’s Author  | Wouter ter Maat of Offensi                       |                   |


## 二、组件简介
Kubernetes API 服务器验证并配置 API 对象的数据， 这些对象包括 pods、services、replicationcontrollers 等。 API 服务器为 REST 操作提供服务，并为集群的共享状态提供前端， 所有其他组件都通过该前端进行交互

## 三、漏洞详情

### 1. 介绍
当攻击者控制k8s集群中的一个节点时，可替换节点上的`kubelet`为修改后的恶意`kubelet`，当接收到`kube-apiserver`代理的客户端请求时，恶意`kubelet`返回重定向请求，导致客户端以同样的凭证访问其他api

### 2. 影响
当攻击者有一台节点的root权限且客户端凭证为集群管理员时，攻击者可通过`kubelet`向客户端发重定向请求完成对整个集群的控制

## 四、防御
无缓解措施，需升级`kube-apiserver`

## 五、漏洞复现
### 1. 复现环境
```
docker pull noirfate/vul-k8s-cve-2020-8559:1.0
```
### 2. 复现过程
```
docker-compose up
ssh -p12222 root@127.0.0.1
cd exploit
./run
```

## 六、漏洞分析
- [分析文章](http://blog.nsfocus.net/cve-2020-8559/)

## 七、漏洞修复分析
禁止向客户端返回重定向请求

## 八、漏洞挖掘方法与过程

## 九、同类问题挖掘方法

### 设计实现层

### Fuzz

### codeql

## 十、时间线

